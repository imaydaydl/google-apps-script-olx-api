# Google Apps Script Olx Api
Робота із товарами, які продаються на OLX, використовуючи Google Sheets на Google Apps Script

## Інсталяція
Просто перенесіть весь контент у відповідні файли в google apps script. Відкрийте/Перезавантажте Google таблицю і код одразу створить всі необхідні кнопки та таблиці. Для чого кожна кнопка та таблиці прописано нижче.

## Опис
### Кнопки
`Управління`

    - Кнопка знаходиться в верхньому меню гугл таблиці. Містить в собі кнопки всього створеного функціоналу

    - Створено через функцію меню

`Оновити товари`

    - Оновлює список товарів в таблиці Advert

    - Може збирати дані і додавати товари в таблицю Advert. Якщо товара немає в таблиці Advert, то додає його в таблицю, орієнтиром для цього є колонка ID/SKU. Як саме буде збирати список товарів, потрібно прописати. Приклад вихідних даних прописаний в функції UpdateProducts()

`Відправити в OLX обрані`

    -Відправляє товари з обраних рядків таблиці Advert в OLX

    - Орієнтиром в OLX якої країни відправляти є перша колонка таблиці Advert. Збирає інформацію по товари з таблиці і всю інформацію, яку знайшов відправляє в OLX. Після успішної відправки заповнюються колонки OLX id, OLX url та OLX status, date_create, date_renewal. Якщо товар доданий в OLX і є видимим товаром для усіх, то статус буде Active. Статус limited означає, що товар додано в OLX, але він не рекламується. Причиною цьому може бути те, що OLX потребує покупки їх пакету, адже в одну категорію можна додавати тільки 1 товар.

`Оновити в OLX обрані`

    - Оновлює інформацію по товару обраних з таблиці Advert в OLX

    - Орієнтиром в OLX якої країни оновлювати є перша колонка таблиці Advert та колонка OLX id. Збирає інформацію по товари з таблиці і всю інформацію, яку знайшов відправляє в OLX, оновлює.

`Видалити обрані (модалка)`

    - Видаляє товари із списку таблиці Advert

    - При натисканні цієї кнопки відкривається модалка, в якій необхідно обрати що видаляти. Є 3 варіанти: З таблиці, з OLX та з OLX і з таблиці. З таблиці видаляє тільки з таблиці. З OLX видаляє тільки з таблиці. З OLX і з таблиці видаляє відповідно і з таблиці і з OLX.

`Дублювати обрані`

    - Створює копії обраних рядків з таблиці Advert

    - При натисканні цієї кнопки створюються такі самі рядки в кінці всіх товарів із таблиці Advert. Колонки OLX Id, OLX Url, OLX Status, date_create, date_renewal, advert_views, phone_views, users_observing чистяться в цих задубльованих рядках.

`Оновити статистику`

    - Отримує статистику по твоару з OLX. Отримуються 3 параметри: кількість переглядів, кількість переглядів номера телефона та кількість додавань в улюблене

    - Орієнтиром є перша колонка та OLX id. По цим даним прокидається запит в OLX і отримується статистика. Заповнюються дані в колонки advert_views, phone_views, users_observing

`Оновити повідомлення`

    - Отримує повідомлення по кожному товару з OLX

    - Орієнтиром є перша колонка та OLX id. По цим даним прокидається запит на отримання повідомлень з OLX.  Записується в таблицю Message. При цьому перевіряється чи є айді повідомлення в цій таблиці, для того щоб записувались тільки нові повідомлення. Кожне повідомлення знаходиться в певній темі, тому є колонки Thread. Крім того перевіряється сам користувач, якщо це новий користувач, то він буде доданий в таблицю Clients

`Відповісти на обраний (модалка)`

    - Можливість відповісти на повідомлення клієнту

    - Орієнтиром є колонка thread id. Відповісти можна тільки на 1 повідомлення в одночас, тому для відповіді необхідно обрати тільки 1 рядок. Відкриється модалка із полем для вводу повідомлення. Після відправки повідомлення сама відповідь відправиться в OLX і запишеться в колонку Answer

`Перекласти обрані`

    - Перекладає обрані рядки таблиці Advert на мову вказану в першій колонці

    - Орієнтиром є перша колонка. Перекладає колонки Название та description з будь-якої мови на ту, що вказана в першій колонці.

`Конвертація валюти в обраних (модалка)`

    - Конвертує ціни з однієї валюти в іншу

    - При натисканні цієї кнопки відкривається модалка, де можна вказати з якої валюти і в яку валюту буде відбуватись конвертація. Крім того можна вказати  націнку. Націнку можна вказати в відсотках, максимально допустиме значення 100 (тобто 100%). Спочатку конвертує в необхідну валюту, а потім додає націнку. Максимально допустима кількість конвертацій - 100 на місяць. Саме тому рекомендується конвертувати одразу декілька рядків, а не кожний окремо. Запит на отримання курсу робиться після натискання кнопки Підтвердити і на основі отриманих даних конвертує ціну в кожній обраній колонці.

`Оновити список категорій`

    - Оновлює список категорій з OLX

    - Спочатку видаляє весь список категорій з таблиці Categories, а потім отримує список категорій для кожної країни. Тут орієнтиром вже йде таблиця List, де вказані всі користувачі з OLX. Після оновлення заповнюється селектор в таблиці Advert, колонка OLX category

`Оновити список міст`

    - Оновлює список міст з OLX

    - Отримує список міст з OLX по кожній країні, в яких є акаунт OLX і вказаний в таблиці List. При додаванні перевіряє чи айді такого міста в таблиці Cities, якщо немає то додає до списку.

### Таблиці
`Advert`

    - Таблиця із списком товарів та інформацією, що стосується товарів

`Message`

    - Список повідомлень, які написали клієнти з OLX

`Clients`

    - Список клієнтів. Заповнюється автомаатично, коли клієнт написав повідомлення і ці повідомлення завантажили в таблицю

`List`

    - Список внутрішніх акаунтів на OLX

`Categories`

    - Список категорій OLX по кожній країні, де є внутрішні акаунти OLX, які завантажуються по кнопці "Оновити список категорій"

`Cities`

    - Список міст по кожній країні, де є внутрішні акаунти OLX, які завантажуються по кнопці "Оновити список категорій"

`Tokens`

    - Тут записуються коди авторизації, які необхідні для запитів "Відправити в OLX", "Видалити товари з OLX", "Оновити в OLX", "Оновити повідомлення", "Отримати статистику" виконуються за допомогою authorization_token. Цей токен можна отримати тільки завдяки авторизаційному коду, саме тому при виконанні цих запитів перевіряється таблиця Tokens. Якщо в цій таблиці немає токенів, то відкриється модалка, в якій будуть 2 кнопки та поле для вводу тексту. Перша кнопка це посилання на отримання авторизаційного коду, після авторизації в додатку OLX цей код буде в посиланні в адресному рядку у вигляді ?code=ТУТ_КОД_АВТОРИЗАЦІЇ. Цей код необхідно ввести в поле вводу тексту в модалці і підтвердити. Код при цьому запишеться в таблицю Tokens і буде отримано authorization_code, і по цьому authorization_code буде виконаний необхідний запит. Якщо є записи в таблиці Tokens, то буде перевірятись статус active і active to date. Якщо статус active немає, або active to date вже пройшла дата, то буде відкрита модалка. Якщо дата ще не пройшла, то за цим кодом отримаєтсья authorization_code і відправлено запит.